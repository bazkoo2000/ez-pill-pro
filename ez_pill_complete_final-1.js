javascript:(function(){var APP_VERSION='128.0';var APP_NAME='EZ_Pill Pro';var fixedSizeCodes={'100015980':24,'100015955':24,'100015971':24,'102988654':48,'100013423':10,'100013562':20,'101826688':20,'101284170':30,'103243857':30,'101859640':20,'100726280':24,'100011436':20,'100030493':40,'100011743':30,'103169239':20,'100684294':30,'100009934':48,'100014565':6,'100017942':20,'100633972':20,'100634019':20,'100009926':24,'102371620':24,'100015947':24,'100010652':30,'103437918':30,'103683617':30,'100023592':30,'100023875':20,'100013431':15,'100027201':20,'100016106':10,'100010097':20,'100013167':20};var weeklyInjections=['102785890','101133232','101943745','101049031','101528656'];var warningQueue=[];var monthCounter=0;var originalStartDate='';var duplicatedRows=[];var duplicatedCount=0;function detectLanguage(text){if(!text)return'arabic';var arabicCount=(text.match(/[\u0600-\u06FF]/g)||[]).length;var englishCount=(text.match(/[a-zA-Z]/g)||[]).length;if(englishCount>arabicCount&&englishCount>5){return'english';}return'arabic';}function setPatientLanguage(language){var langSelect=document.querySelector('select[name*="language" i], select[id*="language" i], #flanguage');if(langSelect){var targetValue=language==='english'?'English':'Arabic';var options=langSelect.options;for(var i=0;i<options.length;i++){if(options[i].text===targetValue||options[i].value===targetValue||options[i].text.toLowerCase()===targetValue.toLowerCase()){langSelect.selectedIndex=i;fireEvent(langSelect);return true;}}}}window.ezShowToast=function(msg,type){var t=document.createElement('div');t.className='ez-toast ez-toast-'+type;t.innerHTML='<div class="ez-toast-icon">'+{success:'âœ…',error:'âŒ',info:'â„¹ï¸',warning:'âš ï¸'}[type]+'</div><div class="ez-toast-msg">'+msg+'</div>';document.body.appendChild(t);setTimeout(function(){t.classList.add('show');},10);setTimeout(function(){t.classList.remove('show');setTimeout(function(){t.remove();},300);},3000);};window.ezCancel=function(){var d=document.getElementById('ez-dialog-box');if(d){d.remove();}};window.ezClosePost=function(){var d=document.getElementById('ez-post-dialog');if(d){d.remove();}};window.ezMinimize=function(){var d=document.getElementById('ez-dialog-box');if(d){var content=d.querySelector('.ez-content');var minBtn=d.querySelector('.ez-minimize-btn');if(content.style.display==='none'){content.style.display='block';minBtn.innerHTML='âˆ’';d.style.width='auto';}else{content.style.display='none';minBtn.innerHTML='+';d.style.width='380px';}}};window.ezSelectMode=function(mode){var d=document.getElementById('ez-dialog-box');d.setAttribute('data-extraction-mode',mode);var manualCard=document.querySelector('.mode-choice.manual');var autoCard=document.querySelector('.mode-choice.auto');var optionsSection=document.querySelector('.options-section');var monthsSection=document.querySelector('.months-section');var daysSection=document.querySelector('.days-section');if(mode==='manual'){manualCard.classList.add('selected');autoCard.classList.remove('selected');optionsSection.style.display='block';if(monthsSection)monthsSection.style.display='block';if(daysSection)daysSection.style.display='block';}else{autoCard.classList.add('selected');manualCard.classList.remove('selected');optionsSection.style.display='block';if(monthsSection)monthsSection.style.display='block';if(daysSection)daysSection.style.display='none';}};window.ezSelect=function(el,type,val){var p=el.parentNode;var pills=p.querySelectorAll('.ez-pill');for(var i=0;i<pills.length;i++){pills[i].classList.remove('selected');}el.classList.add('selected');var d=document.getElementById('ez-dialog-box');if(type==='m'){d.setAttribute('data-m',val);}else{d.setAttribute('data-t',val);}};window.showWarnings=function(warnings,callback){if(!warnings||warnings.length===0){callback();return;}var html='<div class="warning-dialog"><div class="warning-header"><div class="warning-icon">âš ï¸</div><div class="warning-title">ØªØ­Ø°ÙŠØ±Ø§Øª ØªØ­ØªØ§Ø¬ Ù…Ø±Ø§Ø¬Ø¹Ø©</div></div><div class="warning-list">';for(var i=0;i<warnings.length;i++){var w=warnings[i];html+='<div class="warning-item warning-'+w.level+'"><div class="warning-text">'+w.message+'</div>';if(w.editable){html+='<div class="warning-edit"><label>'+w.editLabel+':</label><input type="number" id="edit-'+i+'" value="'+w.currentValue+'" min="'+w.minValue+'" max="'+w.maxValue+'"></div>';}html+='</div>';}html+='</div><div class="warning-actions"><button class="warning-btn warning-accept" onclick="window.acceptWarnings()">âœ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button><button class="warning-btn warning-cancel" onclick="window.cancelWarnings()">âŒ Ø¥Ù„ØºØ§Ø¡</button></div></div>';var overlay=document.createElement('div');overlay.id='warning-overlay';overlay.innerHTML=html;overlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.75);backdrop-filter:blur(5px);z-index:999999;display:flex;align-items:center;justify-content:center;';document.body.appendChild(overlay);window.warningCallback=callback;};window.acceptWarnings=function(){var edits={};var inputs=document.querySelectorAll('[id^="edit-"]');for(var i=0;i<inputs.length;i++){var id=inputs[i].id.replace('edit-','');edits[id]=parseInt(inputs[i].value);}for(var key in edits){if(warningQueue[key]&&warningQueue[key].onEdit){warningQueue[key].onEdit(edits[key]);}}var overlay=document.getElementById('warning-overlay');if(overlay){overlay.remove();}if(window.warningCallback)window.warningCallback();};window.cancelWarnings=function(){var overlay=document.getElementById('warning-overlay');if(overlay){overlay.remove();}};window.ezSubmit=function(){try{var d=document.getElementById('ez-dialog-box');if(!d)return;var m=parseInt(d.getAttribute('data-m'))||1;var t=parseInt(d.getAttribute('data-t'))||30;var autoDuration=document.getElementById('auto-duration')?document.getElementById('auto-duration').checked:true;var showWarnings=document.getElementById('show-warnings')?document.getElementById('show-warnings').checked:true;var showPostDialog=document.getElementById('show-post-dialog')?document.getElementById('show-post-dialog').checked:true;d.remove();var loader=document.createElement('div');loader.id='ez-loader';loader.innerHTML='<div class="ez-loader-spinner"></div><div class="ez-loader-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</div>';loader.style.cssText='position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(255,255,255,0.98);padding:40px 60px;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3);z-index:99998;text-align:center;font-family:Cairo,sans-serif;';document.body.appendChild(loader);setTimeout(function(){if(loader)loader.remove();processTable(m,t,autoDuration,showWarnings,showPostDialog);},800);}catch(e){alert("Ø®Ø·Ø£: "+e.message);}};window.ezUndoDuplicates=function(){try{var ts=document.querySelectorAll('table'),tb=null;for(var i=0;i<ts.length;i++){if(ts[i].querySelector('th')&&(ts[i].innerText.toLowerCase().includes('qty')||ts[i].innerText.toLowerCase().includes('quantity'))){tb=ts[i];break;}}if(!tb)return;function fire(el){if(!el)return;el.focus();el.dispatchEvent(new Event('input',{bubbles:true}));el.dispatchEvent(new Event('change',{bubbles:true}));el.dispatchEvent(new Event('blur',{bubbles:true}));}function normL(t){return(t||'').toString().toLowerCase().replace(/[Ø£Ø¥Ø¢]/g,'Ø§').replace(/Ø©/g,'Ù‡Ù€').replace(/Ù‰/g,'ÙŠ').trim();}function get(td){var i=td.querySelector('input,textarea,select');if(i){if(i.tagName==='SELECT'){var o=i.options[i.selectedIndex];return o?o.textContent:i.value;}return i.value;}return td.innerText||td.textContent;}function set(td,v){var i=td.querySelector('input,textarea');if(i){i.value=v;fire(i);}else{var s=td.querySelector('select');if(s){s.value=String(v);fire(s);}else{td.textContent=v;}}}function idx(ths,n){for(var i=0;i<ths.length;i++){if(normL(ths[i].textContent).indexOf(normL(n))>-1)return i;}return-1;}var h=tb.querySelector('tr'),hs=h.querySelectorAll('th,td'),ci=idx(hs,'code'),si=idx(hs,'size'),ni=idx(hs,'note'),ei=idx(hs,'evry');if(ei<0)ei=idx(hs,'every');if(ci<0||si<0||ni<0||ei<0)return;var groups={},rows=Array.from(tb.querySelectorAll('tr')).slice(1);rows.forEach(function(r){var code=get(r.querySelectorAll('td')[ci]).trim();if(code){if(!groups[code])groups[code]=[];groups[code].push(r);}});var foundDuplicates=false;Object.keys(groups).forEach(function(code){var g=groups[code],n=g.length;if(n>1){foundDuplicates=true;var master=g[0],tds=master.querySelectorAll('td'),curS=parseInt(get(tds[si]))||0,mult=n,ev=(n===2?12:8);set(tds[si],curS*mult);set(tds[ei],ev);var allN=g.map(function(row){return get(row.querySelectorAll('td')[ni]);}),fN=allN[0];fN=fN.replace(/^âš¡\s*/,'');for(var k=1;k<allN.length;k++){var next=allN[k].replace(/^âš¡\s*/,'');if((fN.includes('Ø¨Ø¹Ø¯')&&next.includes('Ø¨Ø¹Ø¯'))||(fN.toLowerCase().includes('after')&&next.toLowerCase().includes('after'))){fN+=' & '+next.replace(/Ø¨Ø¹Ø¯|after/gi,'').trim();}else if((fN.includes('Ù‚Ø¨Ù„')&&next.includes('Ù‚Ø¨Ù„'))||(fN.toLowerCase().includes('before')&&next.toLowerCase().includes('before'))){fN+=' & '+next.replace(/Ù‚Ø¨Ù„|before/gi,'').trim();}else{fN+=' & '+next;}}set(tds[ni],fN);for(var j=1;j<n;j++){if(g[j].parentNode)g[j].parentNode.removeChild(g[j]);}}});if(foundDuplicates){window.ezShowToast('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙ‚Ø³ÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­','success');}else{window.ezShowToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØµÙÙˆÙ Ù…ÙƒØ±Ø±Ø©','info');}}catch(e){window.ezShowToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙ‚Ø³ÙŠÙ…','error');}};window.ezNextMonth=function(){monthCounter++;var btn=document.getElementById('ez-next-month-btn');var sDateElem=document.querySelector('#fstartDate');if(!sDateElem)return;var ts=document.querySelectorAll('table'),tb=null;for(var i=0;i<ts.length;i++){if(ts[i].innerText.toLowerCase().includes('qty')||ts[i].innerText.toLowerCase().includes('quantity')){tb=ts[i];break;}}if(!tb)return;var h=tb.querySelector('tr'),hs=h.querySelectorAll('th,td');var si=-1,edi=-1,qi=-1;for(var j=0;j<hs.length;j++){var txt=hs[j].textContent.toLowerCase();if(txt.includes('size'))si=j;if(txt.includes('end date'))edi=j;if(txt.includes('qty'))qi=j;}var rows=tb.querySelectorAll('tr');function fireEvent(el){if(!el)return;el.focus();el.dispatchEvent(new Event('input',{bubbles:true}));el.dispatchEvent(new Event('change',{bubbles:true}));el.dispatchEvent(new Event('blur',{bubbles:true}));}if(monthCounter===1||monthCounter===2){var newStart='';for(var i=1;i<rows.length;i++){var tds=rows[i].querySelectorAll('td');if(tds.length>edi){var ev='';var inp=tds[edi].querySelector('input');ev=inp?inp.value:tds[edi].textContent.trim();if(ev&&ev.match(/\d{4}-\d{2}-\d{2}/)){newStart=ev;break;}}}if(newStart){sDateElem.value=newStart;fireEvent(sDateElem);rows.forEach(function(r,ix){if(ix===0)return;var sInput=r.querySelectorAll('td')[si]?r.querySelectorAll('td')[si].querySelector('input,textarea'):null;if(sInput)fireEvent(sInput);});btn.innerHTML=(monthCounter===1)?'ğŸ“… Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø«Ø§Ù„Ø«':'ğŸ–¨ï¸ ØªØ¬Ù…ÙŠØ¹ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©';btn.style.background=(monthCounter===1)?'linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)':'linear-gradient(135deg, #f6d365 0%, #fda085 100%)';btn.style.color=(monthCounter===1)?'#4a148c':'#bf360c';btn.setAttribute('data-step',String(monthCounter+1));}}else if(monthCounter===3){if(originalStartDate){sDateElem.value=originalStartDate;fireEvent(sDateElem);}rows.forEach(function(r,ix){if(ix===0)return;var tds=r.querySelectorAll('td');if(qi>=0&&tds.length>qi){var qInput=tds[qi].querySelector('input,textarea');if(qInput){qInput.value='3';fireEvent(qInput);}else{tds[qi].textContent='3';}}if(tds.length>si){var sInput=tds[si].querySelector('input,textarea');if(sInput)fireEvent(sInput);}});btn.innerHTML='âœ… ØªÙ… Ø§Ù„ØªØ¬Ù…ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­';btn.style.background='linear-gradient(135deg, #2ecc71, #27ae60)';btn.style.color='#fff';btn.disabled=true;}};window.fixEndDates=function(targetDate,ediIdx){var tb=document.querySelector('table');if(!tb)return;function fire(el){if(!el)return;el.focus();el.dispatchEvent(new Event('input',{bubbles:true}));el.dispatchEvent(new Event('change',{bubbles:true}));el.dispatchEvent(new Event('blur',{bubbles:true}));}var rows=Array.from(tb.querySelectorAll('tr')).slice(1);rows.forEach(function(r){var tds=r.querySelectorAll('td');if(tds.length>ediIdx){var inp=tds[ediIdx].querySelector('input');if(inp){inp.value=targetDate;fire(inp);}}});window.closeEndDateAlert();window.ezShowToast('ØªÙ… ØªÙˆØ­ÙŠØ¯ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®','success');};window.closeEndDateAlert=function(){var overlay=document.getElementById('end-date-overlay');if(overlay){overlay.remove();}};function fireEvent(el){try{if(!el)return;el.focus();el.dispatchEvent(new Event('input',{bubbles:true}));el.dispatchEvent(new Event('change',{bubbles:true}));el.dispatchEvent(new Event('blur',{bubbles:true}));}catch(e){}}function getValue(td){if(!td)return'';var inp=td.querySelector('input');var sel=td.querySelector('select');var txt=td.querySelector('textarea');if(inp&&inp.value)return inp.value.trim();if(sel&&sel.value)return sel.value.trim();if(txt&&txt.value)return txt.value.trim();return td.textContent.trim();}function idx2(ths,n){n=n.toLowerCase();for(var i=0;i<ths.length;i++){var t=(ths[i].textContent||'').toLowerCase();if(t.indexOf(n)>-1)return i;}return-1;}function addDays(dateStr,days){var d=new Date(dateStr);d.setDate(d.getDate()+days);var y=d.getFullYear();var m=('0'+(d.getMonth()+1)).slice(-2);var day=('0'+d.getDate()).slice(-2);return y+'-'+m+'-'+day;}function checkEndDateConsistency(){var tb=document.querySelector('table');if(!tb)return;var ths=tb.querySelectorAll('th');var ediIdx=-1;for(var i=0;i<ths.length;i++){if(ths[i].textContent.toLowerCase().includes('end')&&ths[i].textContent.toLowerCase().includes('date')){ediIdx=i;break;}}if(ediIdx<0)return;var rows=Array.from(tb.querySelectorAll('tr')).slice(1);var dates={};var mostCommonDate='';var maxCount=0;rows.forEach(function(r){var tds=r.querySelectorAll('td');if(tds.length>ediIdx){var inp=tds[ediIdx].querySelector('input');var date=inp?inp.value:tds[ediIdx].textContent.trim();if(date&&/\d{4}-\d{2}-\d{2}/.test(date)){dates[date]=(dates[date]||0)+1;if(dates[date]>maxCount){maxCount=dates[date];mostCommonDate=date;}}}});if(Object.keys(dates).length>1){showEndDateAlert(mostCommonDate,ediIdx);}}function showEndDateAlert(commonDate,ediIdx){var html='<div class="end-date-alert">'+'<div class="alert-header">âš ï¸ ØªØ­Ø°ÙŠØ±: ØªÙˆØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ø®ØªÙ„ÙØ©</div>'+'<div class="alert-body">ØªÙ… Ø§ÙƒØªØ´Ø§Ù ØµÙÙˆÙ Ø¨ØªÙˆØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ø®ØªÙ„ÙØ©.<br>Ù‡Ù„ ØªØ±ÙŠØ¯ ØªÙˆØ­ÙŠØ¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø¥Ù„Ù‰: <strong>'+commonDate+'</strong>ØŸ</div>'+'<div class="alert-actions">'+'<button class="alert-btn alert-fix" onclick="window.fixEndDates(\''+commonDate+'\','+ediIdx+')">âœ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®</button>'+'<button class="alert-btn alert-cancel" onclick="window.closeEndDateAlert()">âŒ Ø¥Ù„ØºØ§Ø¡</button>'+'</div>'+'</div>';var overlay=document.createElement('div');overlay.id='end-date-overlay';overlay.innerHTML=html;overlay.style.cssText='position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.75);backdrop-filter:blur(5px);z-index:999999;display:flex;align-items:center;justify-content:center;';document.body.appendChild(overlay);}function showPostProcessDialog(){var sdInput=document.querySelector('#fstartDate');if(sdInput){originalStartDate=sdInput.value;}monthCounter=0;var dupInfo=duplicatedCount>0?'<div style="background:#dbeafe;padding:8px 12px;border-radius:8px;margin:10px 0;text-align:center;"><span style="font-size:20px;">âš¡</span> <span style="font-weight:700;color:#1e40af;">'+duplicatedCount+' ØµÙ†Ù Ù…Ù‚Ø³Ù…</span></div>':'';var dialog=document.createElement('div');dialog.id='ez-post-dialog';dialog.className='ez-post-draggable';dialog.style.cssText='position:fixed;top:80px;right:20px;background:linear-gradient(145deg,#fff 0%,#f8f9fa 100%);padding:18px 22px;border-radius:16px;box-shadow:0 15px 50px rgba(0,0,0,0.3),0 0 0 1px rgba(59,130,246,0.1);z-index:99998;border:2px solid rgba(59,130,246,0.2);font-family:Cairo,sans-serif;min-width:280px;max-width:320px;';dialog.innerHTML='<div class="ez-post-header" style="text-align:center;margin-bottom:12px;cursor:move;padding:6px;"><div style="font-size:16px;font-weight:800;background:linear-gradient(135deg,#3b82f6,#8b5cf6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:6px;">âš™ï¸ Ø®ÙŠØ§Ø±Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</div><button onclick="window.ezClosePost()" style="position:absolute;top:10px;right:10px;background:linear-gradient(135deg,#ef4444,#dc2626);color:#fff;border:none;width:24px;height:24px;border-radius:50%;cursor:pointer;font-size:16px;line-height:1;transition:all 0.3s;box-shadow:0 3px 10px rgba(239,68,68,0.3);" onmouseover="this.style.transform=\'scale(1.1) rotate(90deg)\'" onmouseout="this.style.transform=\'scale(1) rotate(0deg)\'">Ã—</button></div>'+dupInfo+'<button id="ez-undo-btn" onclick="window.ezUndoDuplicates()" style="width:100%;padding:10px;margin:6px 0;background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff;border:none;border-radius:10px;font-size:13px;font-weight:700;cursor:pointer;font-family:Cairo,sans-serif;transition:all 0.3s;box-shadow:0 3px 10px rgba(245,158,11,0.3);" onmouseover="this.style.transform=\'translateY(-2px)\';this.style.boxShadow=\'0 5px 15px rgba(245,158,11,0.4)\'" onmouseout="this.style.transform=\'translateY(0)\';this.style.boxShadow=\'0 3px 10px rgba(245,158,11,0.3)\'">ğŸ”„ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙ‚Ø³ÙŠÙ…</button><button id="ez-next-month-btn" onclick="window.ezNextMonth()" style="width:100%;padding:10px;margin:6px 0;background:linear-gradient(135deg,#00C9FF,#92FE9D);color:#004d40;border:none;border-radius:10px;font-size:13px;font-weight:700;cursor:pointer;font-family:Cairo,sans-serif;transition:all 0.3s;box-shadow:0 3px 10px rgba(0,201,255,0.3);" onmouseover="this.style.transform=\'translateY(-2px)\';this.style.boxShadow=\'0 5px 15px rgba(0,201,255,0.4)\'" onmouseout="this.style.transform=\'translateY(0)\';this.style.boxShadow=\'0 3px 10px rgba(0,201,255,0.3)\'">ğŸ—“ï¸ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„ØªØ§Ù„ÙŠ (2)</button>';document.body.appendChild(dialog);makeDraggable(dialog);}function makeDraggable(el){var pos1=0,pos2=0,pos3=0,pos4=0;var header=el.querySelector('.ez-post-header')||el.querySelector('.ez-header')||el;header.style.cursor='move';header.onmousedown=dragMouseDown;function dragMouseDown(e){e=e||window.event;e.preventDefault();pos3=e.clientX;pos4=e.clientY;document.onmouseup=closeDragElement;document.onmousemove=elementDrag;}function elementDrag(e){e=e||window.event;e.preventDefault();pos1=pos3-e.clientX;pos2=pos4-e.clientY;pos3=e.clientX;pos4=e.clientY;var newTop=el.offsetTop-pos2;var newLeft=el.offsetLeft-pos1;el.style.top=newTop+'px';el.style.left=newLeft+'px';el.style.right='auto';el.style.transform='none';}function closeDragElement(){document.onmouseup=null;document.onmousemove=null;}}function extractPillCount(itemName){var s=itemName.trim().toUpperCase();s=s.replace(/\s+/g,' ');var cleaned=s.replace(/(\d+(?:\.\d+)?)\s*(MG|Ù…Ù„Ø¬Ù…|Ù…Ù„Øº|Ù…Ø¬Ù…|MCG|ÂµG|Î¼G|GR|GM|GRAM|Ø¬Ø±Ø§Ù…|Ø¬Ù…|ML|IU|KG|ÙƒØ¬Ù…)/g,'');cleaned=cleaned.replace(/\s+/g,' ').trim();var allMatches=[];var patterns=[{r:/(\d+)\s*(TAB|TABLET|TABLETS)/g,p:1,n:'tablet'},{r:/(\d+)\s*(Ù‚Ø±Øµ|Ø§Ù‚Ø±Ø§Øµ|Ø£Ù‚Ø±Ø§Øµ)/g,p:1,n:'Ù‚Ø±Øµ'},{r:/(\d+)\s*(Ø­Ø¨Ø©|Ø­Ø¨Ù‡|Ø­Ø¨ÙˆØ¨)/g,p:1,n:'Ø­Ø¨Ø©'},{r:/(\d+)\s*(CAP|CAPS|CAPSULE|CAPSULES)/g,p:1,n:'capsule'},{r:/(\d+)\s*(ÙƒØ¨Ø³ÙˆÙ„Ø©|ÙƒØ¨Ø³ÙˆÙ„Ù‡|ÙƒØ¨Ø³ÙˆÙ„Ø§Øª)/g,p:1,n:'ÙƒØ¨Ø³ÙˆÙ„Ø©'},{r:/(\d+)\s*[PTC]/g,p:2,n:'letter'},{r:/(\d+)\s*(PCS|PC|PIECE|PIECES)/g,p:3,n:'pcs'},{r:/(\d+)\s*(Ø¹Ù„Ø¨Ø©|Ø¹Ù„Ø¨)/g,p:3,n:'Ø¹Ù„Ø¨Ø©'}];for(var i=0;i<patterns.length;i++){var pat=patterns[i];pat.r.lastIndex=0;var m;while((m=pat.r.exec(cleaned))!==null){var num=parseInt(m[1]);if(num>0&&num<=500){allMatches.push({val:num,pri:pat.p,pos:m.index,name:pat.n});}}}if(allMatches.length===0){return null;}allMatches.sort(function(a,b){if(a.pri!==b.pri)return a.pri-b.pri;return b.pos-a.pos;});return allMatches[0].val;}function extractDayOfWeek(note){var s=note.trim();var days=[{ar:['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø­Ø¯','Ø§Ø­Ø¯'],en:['sunday','sun'],day:0},{ar:['Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†','Ø§Ø«Ù†ÙŠÙ†','Ø¥Ø«Ù†ÙŠÙ†'],en:['monday','mon'],day:1},{ar:['Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø«Ù„Ø§Ø«Ø§Ø¡'],en:['tuesday','tue'],day:2},{ar:['Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø§Ø±Ø¨Ø¹Ø§Ø¡','Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ø±Ø¨Ø¹Ø§Ø¡'],en:['wednesday','wed'],day:3},{ar:['Ø§Ù„Ø®Ù…ÙŠØ³','Ø®Ù…ÙŠØ³'],en:['thursday','thu'],day:4},{ar:['Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø¬Ù…Ø¹Ù‡','Ø¬Ù…Ø¹Ø©','Ø¬Ù…Ø¹Ù‡'],en:['friday','fri'],day:5},{ar:['Ø§Ù„Ø³Ø¨Øª','Ø³Ø¨Øª'],en:['saturday','sat'],day:6}];var sl=s.toLowerCase();for(var i=0;i<days.length;i++){var d=days[i];for(var j=0;j<d.ar.length;j++){if(s.indexOf(d.ar[j])>-1)return d.day;}for(var j=0;j<d.en.length;j++){if(sl.indexOf(d.en[j])>-1)return d.day;}}return null;}function extractDuration(note){var s=note.toLowerCase().replace(/[Ø£Ø¥Ø¢]/g,'Ø§').replace(/Ø©/g,'Ù‡Ù€').trim();var result={hasDuration:false,days:null,isPRN:false,isUntilFinish:false,original:note};if(/Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ù‡|Ø¹Ù†Ø¯ Ø§Ù„Ù„Ø²ÙˆÙ…|prn|as needed|when needed/i.test(s)){result.isPRN=true;return result;}if(/Ø­ØªÙ‰ (Ù†ÙØ§Ø¯|Ø§Ù†ØªÙ‡Ø§Ø¡|Ø§Ù†Ù‡Ø§Ø¡|Ø§Ù„Ø´ÙØ§Ø¡)|until (finish|complete|symptom)/i.test(s)){result.isUntilFinish=true;return result;}var patterns=[{r:/Ù„Ù…Ø¯Ù‡?\s*(\d+)\s*(ÙŠÙˆÙ…|Ø§ÙŠØ§Ù…)/i,g:1},{r:/Ù…Ø¯Ù‡?\s*(\d+)\s*(ÙŠÙˆÙ…|Ø§ÙŠØ§Ù…)/i,g:1},{r:/(\d+)\s*(ÙŠÙˆÙ…|Ø§ÙŠØ§Ù…)/i,g:1},{r:/(\d+)\s*days?/i,g:1},{r:/for\s*(\d+)\s*days?/i,g:1}];for(var i=0;i<patterns.length;i++){var m=s.match(patterns[i].r);if(m){result.hasDuration=true;result.days=parseInt(m[patterns[i].g]);return result;}}var weekPatterns=[{r:/Ø§Ø³Ø¨ÙˆØ¹ ÙˆØ§Ø­Ø¯|ÙˆØ§Ø­Ø¯ Ø§Ø³Ø¨ÙˆØ¹|1 Ø§Ø³Ø¨ÙˆØ¹|one week|1 week/i,d:7},{r:/Ø§Ø³Ø¨ÙˆØ¹ÙŠÙ†|2 Ø§Ø³Ø¨ÙˆØ¹|two weeks|2 weeks/i,d:14},{r:/Ø«Ù„Ø§Ø«(Ù‡)? Ø§Ø³Ø§Ø¨ÙŠØ¹|3 Ø§Ø³Ø§Ø¨ÙŠØ¹|three weeks|3 weeks/i,d:21},{r:/Ø´Ù‡Ø± ÙˆØ§Ø­Ø¯|ÙˆØ§Ø­Ø¯ Ø´Ù‡Ø±|1 Ø´Ù‡Ø±|one month|1 month/i,d:30},{r:/Ø´Ù‡Ø±ÙŠÙ†|2 Ø´Ù‡Ø±|two months|2 months/i,d:60}];for(var i=0;i<weekPatterns.length;i++){if(weekPatterns[i].r.test(s)){result.hasDuration=true;result.days=weekPatterns[i].d;return result;}}return result;}function extractHourlyInterval(note){var s=note.toLowerCase().trim();var result={hasInterval:false,hours:null,timesPerDay:null};var patterns=[{r:/ÙƒÙ„\s*(\d+)\s*Ø³Ø§Ø¹(Ù‡|Ø§Øª|Ø©)/i,g:1},{r:/every\s*(\d+)\s*hours?/i,g:1},{r:/q(\d+)h/i,g:1}];for(var i=0;i<patterns.length;i++){var m=s.match(patterns[i].r);if(m){result.hasInterval=true;result.hours=parseInt(m[patterns[i].g]);result.timesPerDay=Math.floor(24/result.hours);return result;}}return result;}function moveColumnAfter(table,colToMove,colAfter){var rows=table.querySelectorAll('tr');for(var r=0;r<rows.length;r++){var cells=rows[r].querySelectorAll('th,td');if(cells.length<=Math.max(colToMove,colAfter))continue;var cellToMove=cells[colToMove];var cellAfter=cells[colAfter];if(cellToMove&&cellAfter&&cellToMove.parentNode===cellAfter.parentNode){cellAfter.parentNode.insertBefore(cellToMove,cellAfter.nextSibling);}}}function processTable(m,t,autoDuration,enableWarnings,showPostDialog){warningQueue=[];duplicatedRows=[];duplicatedCount=0;var detectedLanguagesPerRow=[];function fire(el){try{if(!el)return;el.focus();el.dispatchEvent(new Event('input',{bubbles:true}));el.dispatchEvent(new Event('change',{bubbles:true}));el.dispatchEvent(new Event('blur',{bubbles:true}));}catch(e){}}function norm(txt){return(txt||'').toString().trim().replace(/\s+/g,' ');}function normL(txt){var n=norm(txt).toLowerCase();return n.replace(/[Ø£Ø¥Ø¢]/g,'Ø§').replace(/Ø©/g,'Ù‡Ù€').replace(/Ø¦/g,'ÙŠ').replace(/Ø¤/g,'Ùˆ').replace(/Ù‰/g,'ÙŠ').trim();}function get(td){if(!td)return'';var i=td.querySelector('input,textarea,select');if(i){if(i.tagName==='SELECT'){var o=i.options[i.selectedIndex];return norm(o?o.textContent:i.value);}return norm(i.value);}return norm(td.innerText||td.textContent);}function getCleanCode(td){var text=get(td);var match=text.match(/\d+/);return match?match[0]:'';}function setSize(td,v){if(!td)return;var i=td.querySelector('input,textarea');if(i){i.value=v;fire(i);}else{td.textContent=v;}}function setEvry(td,v){if(!td)return;var s=td.querySelector('select');if(s){s.value=String(v);fire(s);}else{td.textContent=String(v);}}function setDose(td,v){if(!td)return;var s=td.querySelector('select');if(s){s.value=String(v);fire(s);return;}var i=td.querySelector('input,textarea');if(i){i.value=String(v);fire(i);return;}td.textContent=String(v);}function setTime(r,tm){if(!r||!tm)return;var i=r.querySelector("input[type='time']");if(i){i.value=tm;fire(i);}}function setNote(td,v){if(!td)return;var i=td.querySelector('input,textarea');if(i){i.value=v;fire(i);}else{td.textContent=v;}}function setStartDate(r,dateStr){if(!r||!dateStr)return;var sdInput=r.querySelector('input[type="date"]');if(!sdInput){var inputs=r.querySelectorAll('input');for(var i=0;i<inputs.length;i++){if(inputs[i].value&&/\d{4}-\d{2}-\d{2}/.test(inputs[i].value)){sdInput=inputs[i];break;}}}if(sdInput){sdInput.value=dateStr;fire(sdInput);}}function cleanNote(txt){if(!txt)return'';var c=txt.toString().replace(/[ØŒ,.\-_\\]/g,' ');var a=/(.*?)Ø£ÙŠØ§Ù…/;var e=/(.*?)days/i;if(a.test(c)){c=c.replace(a,'').replace(/^\s*-\s*/,'').trim();}else if(e.test(c)){c=c.replace(e,'').replace(/^\s*-\s*/,'').trim();}return c.replace(/\s+/g,' ').trim();}function idx(ths,n){n=normL(n);for(var i=0;i<ths.length;i++){var txt=normL(ths[i].textContent);if(txt===n||txt.indexOf(n)>-1)return i;}return-1;}function setTopStartDate(){var d=new Date();d.setDate(d.getDate()+1);var y=d.getFullYear(),m_str=('0'+(d.getMonth()+1)).slice(-2),da=('0'+d.getDate()).slice(-2);var t_str=y+'-'+m_str+'-'+da,s=document.querySelector('#fstartDate');if(s){s.value=t_str;fire(s);return true;}return false;}function getNextDayOfWeek(baseDate,targetDay){var base=new Date(baseDate);var currentDay=base.getDay();var daysUntilTarget=(targetDay-currentDay+7)%7;if(daysUntilTarget===0)daysUntilTarget=7;var result=new Date(base);result.setDate(base.getDate()+daysUntilTarget);var y=result.getFullYear();var m=('0'+(result.getMonth()+1)).slice(-2);var d=('0'+result.getDate()).slice(-2);return y+'-'+m+'-'+d;}function getTimeFromWords(w){var s=normL(w);var wEmpty=/empty|stomach|riq|reeq|Ø±ÙŠÙ‚/;var wBkfstBefore=/before.*bre|before.*fatur|before.*breakfast|Ù‚Ø¨Ù„.*ÙØ·Ø±|Ù‚Ø¨Ù„.*ÙØ·Ø§Ø±|Ù‚Ø¨Ù„.*ÙØ·ÙˆØ±|Ù‚Ø¨Ù„.*Ø§ÙØ·Ø§Ø±|Ù‚Ø¨Ù„.*Ø¥ÙØ·Ø§Ø±|Ù‚Ø¨Ù„.*Ø§Ù„Ø§ÙØ·Ø§Ø±/;var wBkfstAfter=/after.*bre|after.*fatur|after.*breakfast|Ø¨Ø¹Ø¯.*ÙØ·Ø±|Ø¨Ø¹Ø¯.*ÙØ·Ø§Ø±|Ø¨Ø¹Ø¯.*ÙØ·ÙˆØ±|Ø¨Ø¹Ø¯.*Ø§ÙØ·Ø§Ø±|Ø¨Ø¹Ø¯.*Ø¥ÙØ·Ø§Ø±|Ø¨Ø¹Ø¯.*Ø§Ù„Ø§ÙØ·Ø§Ø±/;var wMornRaw=/morning|am|ØµØ¨Ø§Ø­/;var wNoonRaw=/noon|Ø¸Ù‡Ø±/;var wLunBefore=/before.*lun|before.*lau|before.*lunch|before.*ØºØ¯Ø§|before.*ØºØ¯Ø§Ø¡|Ù‚Ø¨Ù„.*ØºØ¯Ø§|Ù‚Ø¨Ù„.*ØºØ¯Ø§Ø¡/;var wLunAfter=/after.*lun|after.*lau|after.*lunch|after.*ØºØ¯Ø§|after.*ØºØ¯Ø§Ø¡|Ø¨Ø¹Ø¯.*ØºØ¯Ø§|Ø¨Ø¹Ø¯.*ØºØ¯Ø§Ø¡/;var wAsrRaw=/asr|Ø¹ØµØ±|afternoon|pm/;var wMaghrib=/maghrib|Ù…ØºØ±Ø¨|Ø§Ù„Ù…ØºØ±Ø¨/;var wDinBefore=/before.*din|before.*sup|before.*dinner|before.*asha|before.*Ø¹Ø´Ø§|before.*Ø¹Ø´Ùˆ|Ù‚Ø¨Ù„.*Ø¹Ø´Ø§|Ù‚Ø¨Ù„.*Ø¹Ø´Ùˆ|Ù‚Ø¨Ù„.*Ø¹Ø´Ø§Ø¡|Ù‚Ø¨Ù„.*Ø§Ù„Ø¹Ø´Ø§Ø¡/;var wDinAfter=/after.*din|after.*sup|after.*dinner|after.*asha|after.*Ø¹Ø´Ø§|after.*Ø¹Ø´Ùˆ|Ø¨Ø¹Ø¯.*Ø¹Ø´Ø§|Ø¨Ø¹Ø¯.*Ø¹Ø´Ùˆ|Ø¨Ø¹Ø¯.*Ø¹Ø´Ø§Ø¡|Ø¨Ø¹Ø¯.*Ø§Ù„Ø¹Ø´Ø§Ø¡/;var wEveRaw=/Ù…Ø³Ø§Ø¡|Ù…Ø³Ø§|evening/;var wSleep=/bed|sle|sl|nwm|Ù†ÙˆÙ…/;if(wEmpty.test(s))return{time:'07:00'};if(wBkfstBefore.test(s))return{time:'08:00'};if(wBkfstAfter.test(s))return{time:'09:00'};if(wMornRaw.test(s))return{time:'09:30'};if(wNoonRaw.test(s))return{time:'12:00'};if(wLunBefore.test(s))return{time:'13:00'};if(wLunAfter.test(s))return{time:'14:00'};if(wAsrRaw.test(s))return{time:'15:00'};if(wMaghrib.test(s))return{time:'18:00'};if(wDinBefore.test(s))return{time:'20:00'};if(wDinAfter.test(s))return{time:'21:00'};if(wEveRaw.test(s))return{time:'21:30'};if(wSleep.test(s))return{time:'22:00'};return{time:'09:00'};}function getTwoPillsPerDoseInfo(n){var s=normL(n);var p=['2 Ø­Ø¨Ù‡','2 Ø­Ø¨Ø©','Ø­Ø¨ØªÙŠÙ†','Ø­Ø¨ØªØ§Ù†','2 Ø­Ø¨ÙˆØ¨','2 Ù‚Ø±Øµ','Ù‚Ø±ØµÙŠÙ†','2 ÙƒØ¨Ø³ÙˆÙ„Ø©','ÙƒØ¨Ø³ÙˆÙ„ØªÙŠÙ†','2 pill','2 pills','two pill','two pills','2 tablet','2 tablets','2 tab','2 tabs'];for(var i=0;i<p.length;i++){if(s.includes(p[i])){var is2=s.includes('Ù…Ø±ØªÙŠÙ†')||s.includes('twice')||s.includes('2 times');var is3=s.includes('Ø«Ù„Ø§Ø« Ù…Ø±Ø§Øª')||s.includes('3 Ù…Ø±Ø§Øª')||s.includes('3 times');var ml=1;if(is3)ml=6;else if(is2)ml=4;else ml=2;return{dose:2,multiplier:ml};}}return{dose:1,multiplier:1};}function smartDoseRecognizer(note){var s=normL(note);var res={count:1,hasB:false,hasL:false,hasD:false,isBefore:false,hasM:false,hasN:false,hasA:false,hasE:false,language:'arabic'};res.language=detectLanguage(note);detectedLanguagesPerRow.push(res.language);res.hasB=/bre|breakfast|fatur|ÙØ·Ø±|ÙØ·Ø§Ø±|ÙØ·ÙˆØ±|Ø§ÙØ·Ø§Ø±|Ø¥ÙØ·Ø§Ø±|Ø§Ù„Ø§ÙØ·Ø§Ø±/i.test(s);res.hasL=/lun|lunch|lau|ØºØ¯Ø§|ØºØ¯Ø§Ø¡/i.test(s);res.hasD=/din|dinner|sup|supper|asha|Ø¹Ø´Ø§|Ø¹Ø´Ùˆ|ØªØ¹Ø´Ù‰|Ø¹Ø´Ø§Ø¡|Ø§Ù„Ø¹Ø´Ø§Ø¡/i.test(s);res.hasM=/morning|am|ØµØ¨Ø§Ø­/i.test(s);res.hasN=/noon|Ø¸Ù‡Ø±/i.test(s);res.hasA=/asr|Ø¹ØµØ±|afternoon|pm/i.test(s);res.hasE=/evening|Ù…Ø³Ø§Ø¡|Ù…Ø³Ø§/i.test(s);res.isBefore=/before|bef|pre|Ù‚Ø¨Ù„|meal/i.test(s);var p3=/(?:3|three)\s*(?:times?|Ù…Ø±Ø©|Ù…Ø±Ø§Øª)/i;var p2=/(?:2|two)\s*(?:times?|Ù…Ø±Ø©|Ù…Ø±Ø§Øª)|twice|b\s*i\s*d|bid|ÙƒÙ„\s*12|Ù…Ø±ØªÙŠÙ†/i;var pDual=/(ØµØ¨Ø§Ø­|Ø§Ù„ØµØ¨Ø§Ø­|morning).*(Ù…Ø³Ø§|Ø§Ù„Ù…Ø³Ø§|Ù…Ø³Ø§Ø¡|Ø§Ù„Ù…Ø³Ø§Ø¡|evening)/i;if(p3.test(s)||((res.hasB||res.hasM)&&(res.hasL||res.hasN)&&(res.hasD||res.hasE))||(res.hasM&&res.hasA&&res.hasE)){res.count=3;}else if(p2.test(s)||((res.hasB||res.hasM)&&(res.hasL||res.hasN))||((res.hasL||res.hasN)&&(res.hasD||res.hasE))||((res.hasB||res.hasM)&&(res.hasD||res.hasE))||pDual.test(s)||/Ù‚Ø¨Ù„ (Ø§Ù„Ø§ÙƒÙ„|Ø§ÙƒÙ„) Ù…Ø±ØªÙŠÙ†/.test(s)){res.count=2;}return res;}function shouldDuplicateRow(note){var d=smartDoseRecognizer(note);var s=normL(note);var isEvery8=/ÙƒÙ„\s*8|every\s*8|q8h/i.test(s);if(isEvery8||d.count===3)return{type:'three',doseInfo:d,isBefore:d.isBefore};var isMN=(d.hasM||d.hasB)&&(d.hasN||d.hasL);var isNE=(d.hasN||d.hasL)&&(d.hasE||d.hasD);var isMA=(d.hasM||d.hasB)&&d.hasA;var isAE=d.hasA&&(d.hasE||d.hasD);if(isMN||isNE||isMA||isAE)return{type:'two',doseInfo:d,isBefore:d.isBefore};var isRegularTwice=((d.hasB||d.hasM)&&(d.hasD||d.hasE))||/12|twice|bid|b\s*i\s*d|Ù…Ø±ØªÙŠÙ†/.test(s)||/(ØµØ¨Ø§Ø­|Ø§Ù„ØµØ¨Ø§Ø­|morning).*(Ù…Ø³Ø§|Ø§Ù„Ù…Ø³Ø§|Ù…Ø³Ø§Ø¡|Ø§Ù„Ù…Ø³Ø§Ø¡|evening)/i.test(s)||/Ù‚Ø¨Ù„ (Ø§Ù„Ø§ÙƒÙ„|Ø§ÙƒÙ„) Ù…Ø±ØªÙŠÙ†/.test(s);if(d.count===2&&!isRegularTwice)return{type:'two',doseInfo:d,isBefore:d.isBefore};return null;}function createDuplicateRows(t_val,r,ni,bs,niIdx,si,ei,di,ti,sdi,edi,m_val,tc,ci,qi){var tds=r.querySelectorAll('td');var u_code=getCleanCode(tds[ci]);var ns=bs;if(fixedSizeCodes[u_code]){var div=(ni.type==='three')?3:2;ns=Math.floor(fixedSizeCodes[u_code]/div);var remainder=fixedSizeCodes[u_code]%div;if(remainder>0){var splits=[];for(var x=0;x<div;x++){if(x<remainder){splits.push(Math.ceil(fixedSizeCodes[u_code]/div));}else{splits.push(Math.floor(fixedSizeCodes[u_code]/div));}}ni.customSplits=splits;}}var on=get(r.querySelectorAll('td')[niIdx]);var isEn=/[a-z]/i.test(on)||ni.doseInfo.language==='english';var p=ni.isBefore?(isEn?'Before ':'Ù‚Ø¨Ù„ '):(isEn?'After ':'Ø¨Ø¹Ø¯ ');var bf=isEn?'Breakfast':'Ø§Ù„ÙØ·Ø§Ø±';var ln=isEn?'Lunch':'Ø§Ù„ØºØ¯Ø§Ø¡';var dn=isEn?'Dinner':'Ø§Ù„Ø¹Ø´Ø§Ø¡';var m_lbl=isEn?'Morning':'ØµØ¨Ø§Ø­Ø§';var n_lbl=isEn?'Noon':'Ø¸Ù‡Ø±Ø§';var a_lbl=isEn?'Afternoon':'Ø¹ØµØ±Ø§';var e_lbl=isEn?'Evening':'Ù…Ø³Ø§Ø¡Ø§';var calcQ=1;if(qi>=0){var cur=parseInt(get(tds[qi]))||1;calcQ=cur*m_val;}var dupRows=[];var meals=[];if(ni.type==='two'){var nr1=r.cloneNode(true);var nr2=r.cloneNode(true);var nt1=nr1.querySelectorAll('td');var nt2=nr2.querySelectorAll('td');var sz1=ni.customSplits?ni.customSplits[0]:ns;var sz2=ni.customSplits?ni.customSplits[1]:ns;setSize(nt1[si],sz1);setSize(nt2[si],sz2);setEvry(nt1[ei],'24');setEvry(nt2[ei],'24');if(di>=0){var tpi=getTwoPillsPerDoseInfo(get(r.querySelectorAll('td')[niIdx]));setDose(nt1[di],tpi.dose);setDose(nt2[di],tpi.dose);}if(qi>=0){setSize(nt1[qi],calcQ);setSize(nt2[qi],calcQ);}var n1='',t1='',n2='',t2='';if(ni.doseInfo.hasM&&ni.doseInfo.hasN){n1=m_lbl;t1='09:30';n2=n_lbl;t2='12:00';meals=['Ø§Ù„ØµØ¨Ø§Ø­','Ø§Ù„Ø¸Ù‡Ø±'];}else if(ni.doseInfo.hasN&&ni.doseInfo.hasE){n1=n_lbl;t1='12:00';n2=e_lbl;t2='21:30';meals=['Ø§Ù„Ø¸Ù‡Ø±','Ø§Ù„Ù…Ø³Ø§Ø¡'];}else if(ni.doseInfo.hasM&&ni.doseInfo.hasA){n1=m_lbl;t1='09:30';n2=a_lbl;t2='15:00';meals=['Ø§Ù„ØµØ¨Ø§Ø­','Ø§Ù„Ø¹ØµØ±'];}else if(ni.doseInfo.hasA&&ni.doseInfo.hasE){n1=a_lbl;t1='15:00';n2=e_lbl;t2='21:30';meals=['Ø§Ù„Ø¹ØµØ±','Ø§Ù„Ù…Ø³Ø§Ø¡'];}else if(ni.doseInfo.hasB&&ni.doseInfo.hasL){if(ni.isBefore){n1=p+bf;t1='08:00';n2=p+ln;t2='13:00';}else{n1=p+bf;t1='09:00';n2=p+ln;t2='14:00';}meals=isEn?['Breakfast','Lunch']:['Ø§Ù„ÙØ·Ø§Ø±','Ø§Ù„ØºØ¯Ø§Ø¡'];}else if(ni.doseInfo.hasL&&ni.doseInfo.hasD){if(ni.isBefore){n1=p+ln;t1='13:00';n2=p+dn;t2='20:00';}else{n1=p+ln;t1='14:00';n2=p+dn;t2='21:00';}meals=isEn?['Lunch','Dinner']:['Ø§Ù„ØºØ¯Ø§Ø¡','Ø§Ù„Ø¹Ø´Ø§Ø¡'];}else{if(ni.isBefore){n1=p+bf;t1='08:00';n2=p+dn;t2='20:00';}else{n1=p+bf;t1='09:00';n2=p+dn;t2='21:00';}meals=isEn?['Breakfast','Dinner']:['Ø§Ù„ÙØ·Ø§Ø±','Ø§Ù„Ø¹Ø´Ø§Ø¡'];}setNote(nt1[niIdx],'âš¡ '+n1);setNote(nt2[niIdx],'âš¡ '+n2);setTime(nr1,t1);setTime(nr2,t2);r.parentNode.insertBefore(nr1,r);r.parentNode.insertBefore(nr2,r);dupRows=[nr1,nr2];}else if(ni.type==='three'){var nr1=r.cloneNode(true);var nr2=r.cloneNode(true);var nr3=r.cloneNode(true);var nt1=nr1.querySelectorAll('td');var nt2=nr2.querySelectorAll('td');var nt3=nr3.querySelectorAll('td');var sz1=ni.customSplits?ni.customSplits[0]:ns;var sz2=ni.customSplits?ni.customSplits[1]:ns;var sz3=ni.customSplits?ni.customSplits[2]:ns;setSize(nt1[si],sz1);setSize(nt2[si],sz2);setSize(nt3[si],sz3);setEvry(nt1[ei],'24');setEvry(nt2[ei],'24');setEvry(nt3[ei],'24');if(di>=0){var tpi=getTwoPillsPerDoseInfo(get(r.querySelectorAll('td')[niIdx]));setDose(nt1[di],tpi.dose);setDose(nt2[di],tpi.dose);setDose(nt3[di],tpi.dose);}if(qi>=0){setSize(nt1[qi],calcQ);setSize(nt2[qi],calcQ);setSize(nt3[qi],calcQ);}var n1='',t1='',n2='',t2='',n3='',t3='';if(ni.doseInfo.hasM&&ni.doseInfo.hasA&&ni.doseInfo.hasE){n1=m_lbl;t1='09:30';n2=a_lbl;t2='15:00';n3=e_lbl;t3='21:30';meals=isEn?['Morning','Afternoon','Evening']:['Ø§Ù„ØµØ¨Ø§Ø­','Ø§Ù„Ø¹ØµØ±','Ø§Ù„Ù…Ø³Ø§Ø¡'];}else{if(ni.isBefore){n1=p+bf;t1='08:00';n2=p+ln;t2='13:00';n3=p+dn;t3='20:00';}else{n1=p+bf;t1='09:00';n2=p+ln;t2='14:00';n3=p+dn;t3='21:00';}meals=isEn?['Breakfast','Lunch','Dinner']:['Ø§Ù„ÙØ·Ø§Ø±','Ø§Ù„ØºØ¯Ø§Ø¡','Ø§Ù„Ø¹Ø´Ø§Ø¡'];}setNote(nt1[niIdx],'âš¡ '+n1);setNote(nt2[niIdx],'âš¡ '+n2);setNote(nt3[niIdx],'âš¡ '+n3);setTime(nr1,t1);setTime(nr2,t2);setTime(nr3,t3);r.parentNode.insertBefore(nr1,r);r.parentNode.insertBefore(nr2,r);r.parentNode.insertBefore(nr3,r);dupRows=[nr1,nr2,nr3];}duplicatedRows.push({originalRow:r,duplicates:dupRows,type:ni.type,meals:meals});duplicatedCount++;if(r.parentNode)r.parentNode.removeChild(r);}function sortRowsByTime(t_elem,ti_idx,ei_idx){if(ti_idx<0)return;var rs_elem=Array.from(t_elem.querySelectorAll('tr'));var h_elem=rs_elem.shift();var rwt_arr=[];var rwot_arr=[];rs_elem.forEach(function(r_elem){var tds_elem=r_elem.querySelectorAll('td');if(tds_elem.length<=ti_idx){rwot_arr.push(r_elem);return;}var tv_str=get(tds_elem[ti_idx]);if(!tv_str||tv_str.trim()===''){rwot_arr.push(r_elem);return;}rwt_arr.push({row:r_elem,time:tv_str});});rwt_arr.sort(function(a,b){var ta=a.time.split(':').map(Number);var tb=b.time.split(':').map(Number);var diff=(ta[0]*60+ta[1])-(tb[0]*60+tb[1]);if(diff===0&&ei_idx>=0){var evA=parseInt(get(a.row.querySelectorAll('td')[ei_idx]))||0;var evB=parseInt(get(b.row.querySelectorAll('td')[ei_idx]))||0;return evB-evA;}return diff;});t_elem.innerHTML='';t_elem.appendChild(h_elem);rwt_arr.forEach(function(i_obj){t_elem.appendChild(i_obj.row);});rwot_arr.forEach(function(r_elem){t_elem.appendChild(r_elem);});}function showUniqueItemsCount(t_elem,ci_idx){var s_set=new Set();t_elem.querySelectorAll('tr').forEach(function(r_elem,ri_idx){if(ri_idx===0)return;var tds_elem=r_elem.querySelectorAll('td');if(tds_elem.length<=ci_idx)return;var c_str=get(tds_elem[ci_idx]);if(c_str&&c_str.trim()!=='')s_set.add(c_str.trim());});return s_set.size;}function getCheckmarkCellIndex(r_elem){var tds_elem=r_elem.querySelectorAll('td');for(var i=0;i<tds_elem.length;i++){if(tds_elem[i].querySelector('input[type="checkbox"]')||tds_elem[i].querySelector('img[src*="check"]')){return i;}}return-1;}function resetCheckmark(r_elem,checkmarkIdx){if(checkmarkIdx<0)return;var tds_elem=r_elem.querySelectorAll('td');if(tds_elem.length<=checkmarkIdx)return;var checkbox_elem=tds_elem[checkmarkIdx].querySelector('input[type="checkbox"]');if(checkbox_elem){checkbox_elem.checked=false;fire(checkbox_elem);}}setTopStartDate();var ts_list=document.querySelectorAll('table');var tb_main=null;for(var i=0;i<ts_list.length;i++){if(ts_list[i].querySelector('th')&&(ts_list[i].innerText.toLowerCase().includes('qty')||ts_list[i].innerText.toLowerCase().includes('quantity'))){tb_main=ts_list[i];break;}}if(!tb_main){alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„');return;}var h_main=tb_main.querySelector('tr');var hs_main=h_main.querySelectorAll('th,td');var qi_main=idx(hs_main,'qty');var si_main=idx(hs_main,'size');var ni_main=idx(hs_main,'note');var ei_main=idx(hs_main,'every');if(ei_main<0)ei_main=idx(hs_main,'evry');var ti_main=idx(hs_main,'time');var di_main=idx(hs_main,'dose');var ci_main=idx(hs_main,'code');var sdi_main=idx(hs_main,'start date');var edi_main=idx(hs_main,'end date');var nm_main=idx(hs_main,'name');if(nm_main<0)nm_main=idx(hs_main,'item');if(qi_main<0||si_main<0||ni_main<0||ei_main<0){alert('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');return;}if(ti_main>=0&&ni_main>=0&&ti_main<ni_main){moveColumnAfter(tb_main,ni_main,ti_main);ni_main=ti_main+1;if(ti_main<di_main)di_main++;if(ti_main<ei_main)ei_main++;if(ti_main<sdi_main)sdi_main++;if(ti_main<edi_main)edi_main++;}if(sdi_main>=0){hs_main=h_main.querySelectorAll('th,td');hs_main[sdi_main].style.width='120px';hs_main[sdi_main].style.minWidth='120px';}if(edi_main>=0){hs_main=h_main.querySelectorAll('th,td');hs_main[edi_main].style.width='120px';hs_main[edi_main].style.minWidth='120px';}if(ni_main>=0){hs_main=h_main.querySelectorAll('th,td');hs_main[ni_main].style.width='180px';hs_main[ni_main].style.minWidth='180px';}var rtd_list=[];var rtp_list=[];var skp_list=[];var processedCodes={};var allRowsData=[];tb_main.querySelectorAll('tr').forEach(function(r_node,ri_idx){if(ri_idx===0)return;var tds_nodes=r_node.querySelectorAll('td');if(nm_main>=0&&tds_nodes.length>nm_main){var n_val=get(tds_nodes[nm_main]);if(/refrigerator|Ø«Ù„Ø§Ø¬Ù‡|Ø«Ù„Ø§Ø¬Ø©|cream|syrup|ÙƒØ±ÙŠÙ…|Ù…Ø±Ù‡Ù…|Ø´Ø±Ø§Ø¨|Ù‚Ø·Ø±Ø©|drop|Ø­Ù‚Ù†Ø©|injection|Ù„Ø¨ÙˆØ³|suppository|ØºØ±ØºØ±Ø©|mouthwash|Ø¨Ø®Ø§Ø®|spray|Ù…Ø­Ù„ÙˆÙ„|solution|Ø£Ù†Ù|nasal|Ø¹ÙŠÙ†|eye|Ø£Ø°Ù†|ear|glucose|Ø¬Ù„ÙˆÙƒÙˆØ²|strip|Ø´Ø±ÙŠØ·|Ø´Ø±Ø§Ø¦Ø·|lancet|Ù„Ø§Ù†Ø³ÙŠØª|Ø´ÙƒØ§ÙƒØ©|alcohol|ÙƒØ­ÙˆÙ„|pads|Ø¨Ø§Ø¯|accu|chek|test|ÙØ­Øµ|blood|Ø¯Ù…|device|Ø¬Ù‡Ø§Ø²|disposable|one-touch|ÙˆÙ† ØªØ§ØªØ´|ÙˆØ§Ù† ØªØ§Ø´|Ù†Ø§Ù†Ùˆ|Ù†Ù‡Ø¯ÙŠ|nahdi/i.test(n_val)){var ck_idx=getCheckmarkCellIndex(r_node);resetCheckmark(r_node,ck_idx);skp_list.push(r_node);return;}}var cb_node=r_node.querySelector('input[type="checkbox"]');if(cb_node&&!cb_node.checked){skp_list.push(r_node);return;}if(ci_main>=0&&tds_nodes.length>ci_main){var cd_str=getCleanCode(tds_nodes[ci_main]);if(cd_str){if(processedCodes[cd_str]){var ck_idx=getCheckmarkCellIndex(r_node);resetCheckmark(r_node,ck_idx);skp_list.push(r_node);return;}else{processedCodes[cd_str]={row:r_node,note:cleanNote(get(tds_nodes[ni_main]))};rtp_list.push(r_node);return;}}}rtp_list.push(r_node);});for(var i=0;i<rtp_list.length;i++){var r_node=rtp_list[i];var tds_nodes=r_node.querySelectorAll('td');if(tds_nodes.length<=Math.max(qi_main,si_main,ni_main,ei_main))continue;if(sdi_main>=0){var sdInp=tds_nodes[sdi_main].querySelector('input');if(sdInp)sdInp.style.width='120px';}if(edi_main>=0){var edInp=tds_nodes[edi_main].querySelector('input');if(edInp)edInp.style.width='120px';}if(ni_main>=0){var nInp=tds_nodes[ni_main].querySelector('input,textarea');if(nInp){nInp.style.width='100%';nInp.style.minWidth='180px';}}var nc_node=tds_nodes[ni_main];var ni3_node=nc_node.querySelector('input,textarea');var nt_str=ni3_node?ni3_node.value:nc_node.textContent;var cn_str=cleanNote(nt_str);if(ni3_node){ni3_node.value=cn_str;fire(ni3_node);}else{nc_node.textContent=cn_str;}var itemCode=getCleanCode(tds_nodes[ci_main]);var itemName=nm_main>=0?get(tds_nodes[nm_main]):'';if(processedCodes[itemCode]){processedCodes[itemCode].note=cn_str;}var fn_str=cn_str;var nl_str=normL(fn_str);var dui_obj=shouldDuplicateRow(nl_str);var hasFixedSize=!!(itemCode&&fixedSizeCodes[itemCode]);var h_s=!!(itemCode&&weeklyInjections.indexOf(itemCode)>-1);var durationInfo=null;var hourlyInfo=null;var calculatedDays=t;var calculatedSize=t;var extractedPillCount=null;if(extractionMode==='auto'&&nm_main>=0&&!hasFixedSize&&!h_s){extractedPillCount=extractPillCount(itemName);}if(autoDuration){durationInfo=extractDuration(fn_str);if(durationInfo.hasDuration){calculatedDays=durationInfo.days;calculatedSize=durationInfo.days;}else if(durationInfo.isPRN){calculatedDays=t;calculatedSize=Math.floor(t/2);}else if(durationInfo.isUntilFinish){calculatedDays=t;calculatedSize=t;}}hourlyInfo=extractHourlyInterval(fn_str);var timesPerDay=1;if(hourlyInfo.hasInterval){timesPerDay=hourlyInfo.timesPerDay;}allRowsData.push({row:r_node,tds:tds_nodes,itemCode:itemCode,itemName:itemName,note:fn_str,dui:dui_obj,hasFixedSize:hasFixedSize,isWeekly:h_s,durationInfo:durationInfo,hourlyInfo:hourlyInfo,calculatedDays:calculatedDays,calculatedSize:calculatedSize,timesPerDay:timesPerDay,extractedPillCount:extractedPillCount,warningOverride:false});}if(extractionMode==='auto'){var minDays=9999;var regularRows=[];for(var i=0;i<allRowsData.length;i++){var rd=allRowsData[i];if(rd.hasFixedSize||rd.isWeekly)continue;var doseInfo=smartDoseRecognizer(rd.note);var isE12=/12|twice|bid|b\s*i\s*d|Ù…Ø±ØªÙŠÙ†/.test(rd.note)||(doseInfo.hasB&&doseInfo.hasD)||(doseInfo.hasM&&doseInfo.hasE)||/(ØµØ¨Ø§Ø­|Ø§Ù„ØµØ¨Ø§Ø­|morning).*(Ù…Ø³Ø§|Ø§Ù„Ù…Ø³Ø§|Ù…Ø³Ø§Ø¡|Ø§Ù„Ù…Ø³Ø§Ø¡|evening)/i.test(rd.note)||/Ù‚Ø¨Ù„ (Ø§Ù„Ø§ÙƒÙ„|Ø§ÙƒÙ„) Ù…Ø±ØªÙŠÙ†/.test(rd.note);var actualTimesPerDay=rd.timesPerDay;if(rd.hourlyInfo.hasInterval){actualTimesPerDay=rd.hourlyInfo.timesPerDay;}else if(doseInfo.count===3||/ÙƒÙ„\s*8|every\s*8/.test(rd.note)){actualTimesPerDay=3;}else if(doseInfo.count===2||isE12){actualTimesPerDay=2;}else{actualTimesPerDay=1;}var pillCount=rd.extractedPillCount||rd.calculatedSize;if(rd.extractedPillCount&&rd.extractedPillCount<=35&&actualTimesPerDay>=2){pillCount=rd.extractedPillCount*actualTimesPerDay;}var rowDays=Math.floor(pillCount/actualTimesPerDay);regularRows.push({index:i,days:rowDays,pillCount:pillCount,timesPerDay:actualTimesPerDay,originalExtracted:rd.extractedPillCount,shouldAlign:rd.extractedPillCount<=35});if(rowDays<minDays){minDays=rowDays;}}if(minDays<9999&&regularRows.length>0){for(var j=0;j<regularRows.length;j++){if(regularRows[j].shouldAlign){var idx=regularRows[j].index;var newPillCount=minDays*regularRows[j].timesPerDay;allRowsData[idx].calculatedSize=newPillCount;allRowsData[idx].calculatedDays=minDays;}}}}if(enableWarnings){for(var i=0;i<allRowsData.length;i++){var rd=allRowsData[i];if(rd.durationInfo&&rd.durationInfo.hasDuration){var extracted=rd.durationInfo.days;var selected=t;if(extracted!==selected){warningQueue.push({level:'warning',message:'ğŸ“… Ø§Ù„ØµÙ†Ù: '+rd.itemName+' - Ù…ÙƒØªÙˆØ¨ "'+extracted+' ÙŠÙˆÙ…" Ù„ÙƒÙ† Ø§Ù„Ù…Ø­Ø¯Ø¯ '+selected+' ÙŠÙˆÙ…',editable:true,editLabel:'Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…',currentValue:extracted,minValue:1,maxValue:365,rowIndex:i,onEdit:function(idx){return function(newVal){allRowsData[idx].calculatedDays=newVal;allRowsData[idx].calculatedSize=newVal;allRowsData[idx].warningOverride=true;};}(i)});}}if(rd.hasFixedSize&&rd.dui){var totalSize=fixedSizeCodes[rd.itemCode];var parts=rd.dui.type==='three'?3:2;var eachPart=Math.floor(totalSize/parts);if(eachPart<5){warningQueue.push({level:'info',message:'â„¹ï¸ ØªÙ‚Ø³ÙŠÙ… ØµØºÙŠØ±: '+rd.itemName+' Ø³ÙŠØµØ¨Ø­ '+eachPart+' Ø­Ø¨Ø© Ù„ÙƒÙ„ Ø¬Ø±Ø¹Ø©',editable:false,rowIndex:i});}}}}if(warningQueue.length>0&&enableWarnings){window.showWarnings(warningQueue,function(){continueProcessing();});}else{continueProcessing();}function continueProcessing(){var defaultStartDate=document.querySelector('#fstartDate')?document.querySelector('#fstartDate').value:null;for(var i=0;i<allRowsData.length;i++){var rd=allRowsData[i];var r_node=rd.row;var tds_nodes=rd.tds;if(rd.dui){if(qi_main>=0){var qc_node=tds_nodes[qi_main];var cur_val=parseInt(get(qc_node))||1;setSize(qc_node,cur_val*m);}rtd_list.push({row:r_node,info:rd.dui,calcDays:rd.calculatedDays});continue;}if(rd.hasFixedSize&&!rd.warningOverride){setSize(tds_nodes[si_main],fixedSizeCodes[rd.itemCode]);var tm_fix=getTimeFromWords(rd.note);setTime(r_node,tm_fix.time);var dose_fix=smartDoseRecognizer(rd.note);var isE12_fix=rd.note.includes('ÙƒÙ„ 12')||/12|twice|bid|b\s*i\s*d|Ù…Ø±ØªÙŠÙ†/.test(rd.note)||(dose_fix.hasB&&dose_fix.hasD)||(dose_fix.hasM&&dose_fix.hasE)||/(ØµØ¨Ø§Ø­|Ø§Ù„ØµØ¨Ø§Ø­|morning).*(Ù…Ø³Ø§|Ø§Ù„Ù…Ø³Ø§|Ù…Ø³Ø§Ø¡|Ø§Ù„Ù…Ø³Ø§Ø¡|evening)/i.test(rd.note)||/Ù‚Ø¨Ù„ (Ø§Ù„Ø§ÙƒÙ„|Ø§ÙƒÙ„) Ù…Ø±ØªÙŠÙ†/.test(rd.note);if(dose_fix.count===3||rd.timesPerDay===3){setEvry(tds_nodes[ei_main],'8');}else if(dose_fix.count===2||isE12_fix||rd.timesPerDay===2){setEvry(tds_nodes[ei_main],'12');}else{setEvry(tds_nodes[ei_main],'24');}if(di_main>=0){var tpi_fix=getTwoPillsPerDoseInfo(rd.note);setDose(tds_nodes[di_main],tpi_fix.dose===2?2:1);}if(qi_main>=0){var cur=parseInt(get(tds_nodes[qi_main]))||1;setSize(tds_nodes[qi_main],cur*m);}continue;}if(rd.isWeekly){var bs_val=(rd.calculatedDays==28?4:5)+(m-1)*4;setSize(tds_nodes[si_main],bs_val);setEvry(tds_nodes[ei_main],'168');if(qi_main>=0){var cur=parseInt(get(tds_nodes[qi_main]))||1;setSize(tds_nodes[qi_main],cur);}var tm_fix=getTimeFromWords(rd.note);setTime(r_node,tm_fix.time);var targetDay=extractDayOfWeek(rd.note);if(targetDay!==null&&defaultStartDate&&sdi_main>=0){var newStartDate=getNextDayOfWeek(defaultStartDate,targetDay);setStartDate(r_node,newStartDate);}continue;}if(qi_main>=0){var qc_node=tds_nodes[qi_main];var cur_val=parseInt(get(qc_node))||1;setSize(qc_node,cur_val*m);}var doseInfo=smartDoseRecognizer(rd.note);var tpi_obj=getTwoPillsPerDoseInfo(rd.note);var itpp_bool=tpi_obj.dose===2;var tm2_obj=getTimeFromWords(rd.note);var is48h=/48|ÙŠÙˆÙ… Ø¨Ø¹Ø¯ ÙŠÙˆÙ…|ÙŠÙˆÙ… ÙˆÙŠÙˆÙ…|every other day|day after day/.test(rd.note);if(is48h){setEvry(tds_nodes[ei_main],'48');var mult=itpp_bool?2:1;if(doseInfo.count>=2){setSize(tds_nodes[si_main],rd.calculatedSize*mult);}else{setSize(tds_nodes[si_main],Math.floor((rd.calculatedSize*mult)/2));}setTime(r_node,tm2_obj.time);continue;}var finalTimesPerDay=rd.timesPerDay;if(rd.hourlyInfo.hasInterval){finalTimesPerDay=rd.hourlyInfo.timesPerDay;}var isE12_bool=rd.note.includes('ÙƒÙ„ 12')||/12|twice|bid|b\s*i\s*d|Ù…Ø±ØªÙŠÙ†/.test(rd.note)||(doseInfo.hasB&&doseInfo.hasD)||(doseInfo.hasM&&doseInfo.hasE)||/(ØµØ¨Ø§Ø­|Ø§Ù„ØµØ¨Ø§Ø­|morning).*(Ù…Ø³Ø§|Ø§Ù„Ù…Ø³Ø§|Ù…Ø³Ø§Ø¡|Ø§Ù„Ù…Ø³Ø§Ø¡|evening)/i.test(rd.note)||/Ù‚Ø¨Ù„ (Ø§Ù„Ø§ÙƒÙ„|Ø§ÙƒÙ„) Ù…Ø±ØªÙŠÙ†/.test(rd.note);if(finalTimesPerDay===4){setSize(tds_nodes[si_main],itpp_bool?rd.calculatedSize*8:rd.calculatedSize*4);setEvry(tds_nodes[ei_main],'6');}else if(isE12_bool||finalTimesPerDay===2){setSize(tds_nodes[si_main],itpp_bool?rd.calculatedSize*4:rd.calculatedSize*2);setEvry(tds_nodes[ei_main],'12');setTime(r_node,tm2_obj.time);}else if(doseInfo.count===3||finalTimesPerDay===3){setSize(tds_nodes[si_main],itpp_bool?rd.calculatedSize*6:rd.calculatedSize*3);setEvry(tds_nodes[ei_main],'8');}else if(doseInfo.count===2){setSize(tds_nodes[si_main],itpp_bool?rd.calculatedSize*4:rd.calculatedSize*2);setEvry(tds_nodes[ei_main],'12');setTime(r_node,tm2_obj.time);}else{setSize(tds_nodes[si_main],itpp_bool?rd.calculatedSize*2:rd.calculatedSize);setEvry(tds_nodes[ei_main],'24');}if(di_main>=0){setDose(tds_nodes[di_main],itpp_bool?2:1);}if(!isE12_bool){setTime(r_node,tm2_obj.time);}}for(var i=0;i<rtd_list.length;i++){var it_obj=rtd_list[i];createDuplicateRows(it_obj.calcDays,it_obj.row,it_obj.info,it_obj.calcDays,ni_main,si_main,ei_main,di_main,ti_main,sdi_main,edi_main,m,it_obj.calcDays,ci_main,qi_main);}sortRowsByTime(tb_main,ti_main,ei_main);for(var i=0;i<skp_list.length;i++){var r_node=skp_list[i];var tds_nodes=r_node.querySelectorAll('td');var u_code_skp=getCleanCode(tds_nodes[ci_main]);if(sdi_main>=0&&tds_nodes[sdi_main]){var sdInp=tds_nodes[sdi_main].querySelector('input');if(sdInp)sdInp.style.width='120px';}if(edi_main>=0&&tds_nodes[edi_main]){var edInp=tds_nodes[edi_main].querySelector('input');if(edInp)edInp.style.width='120px';}if(ni_main>=0&&tds_nodes[ni_main]){var nInp=tds_nodes[ni_main].querySelector('input,textarea');var currentNoteRaw=get(tds_nodes[ni_main]);var currentCleanNote=cleanNote(currentNoteRaw);if(nInp){nInp.style.width='100%';nInp.style.minWidth='180px';nInp.value=currentCleanNote;fire(nInp);var firstOccur=processedCodes[u_code_skp];if(firstOccur&&currentCleanNote!==firstOccur.note){nInp.style.backgroundColor='#fff9c4';nInp.style.border='3px solid #ff9800';var firstInp=firstOccur.row.querySelectorAll('td')[ni_main].querySelector('input,textarea');if(firstInp){firstInp.style.backgroundColor='#fff9c4';firstInp.style.border='3px solid #ff9800';}}}else{tds_nodes[ni_main].textContent=currentCleanNote;}}tb_main.appendChild(r_node);}var uc_val=showUniqueItemsCount(tb_main,ci_main);var genBtn_node=Array.from(document.querySelectorAll('button,input')).find(function(b_node){return(b_node.innerText||b_node.value||'').toLowerCase().includes('generate csv');});if(genBtn_node){var bdg_node=document.createElement('span');bdg_node.className='unique-count-badge';bdg_node.innerHTML='Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙ†Ø§Ù: '+uc_val;genBtn_node.parentNode.insertBefore(bdg_node,genBtn_node.nextSibling);}var englishRowCount=detectedLanguagesPerRow.filter(function(l){return l==='english';}).length;var arabicRowCount=detectedLanguagesPerRow.filter(function(l){return l==='arabic';}).length;if(englishRowCount>arabicRowCount){setPatientLanguage('english');}else if(arabicRowCount>0){setPatientLanguage('arabic');}if(duplicatedCount>0){window.ezShowToast('ØªÙ… ØªÙ‚Ø³ÙŠÙ… '+duplicatedCount+' ØµÙ†Ù Ø¥Ù„Ù‰ ØµÙÙˆÙ Ù…ØªØ¹Ø¯Ø¯Ø© âš¡','info');}if(showPostDialog){showPostProcessDialog();}checkEndDateConsistency();window.ezShowToast('ØªÙ…Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¨Ù†Ø¬Ø§Ø­','success');}}var s_style=document.createElement('style');s_style.textContent='@import url("https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap");.ez-dialog{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;padding:18px 20px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.25);z-index:99999;color:#333;text-align:center;font-family:Cairo,sans-serif;min-width:400px;max-width:450px;border:2px solid #3b82f6}.ez-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;padding-bottom:10px;border-bottom:2px solid #e5e7eb;cursor:move}.ez-title{font-size:18px;font-weight:800;color:#3b82f6}.ez-version{font-size:9px;color:#6b7280;background:#f3f4f6;padding:3px 8px;border-radius:6px;font-weight:700}.ez-minimize-btn{background:#6b7280;color:#fff;border:none;width:24px;height:24px;border-radius:50%;cursor:pointer;font-size:16px;font-weight:700;line-height:1;margin-left:8px;transition:all 0.3s}.ez-minimize-btn:hover{background:#374151;transform:scale(1.1)}.mode-section{margin:10px 0;padding:12px;background:#f9fafb;border-radius:10px;border:1px solid #e5e7eb}.mode-title{font-size:12px;font-weight:700;color:#374151;margin-bottom:10px}.mode-choices{display:flex;gap:8px;justify-content:center}.mode-choice{flex:1;padding:10px 8px;background:#fff;border:2px solid #e5e7eb;border-radius:8px;cursor:pointer;transition:all 0.3s;text-align:center;font-size:11px}.mode-choice:hover{border-color:#3b82f6;transform:translateY(-2px)}.mode-choice.selected{background:#3b82f6;border-color:#3b82f6;color:#fff}.mode-icon{font-size:20px;margin-bottom:4px}.mode-name{font-weight:700;margin-bottom:2px}.mode-desc{font-size:9px;opacity:0.85}.options-section{margin-top:10px}.months-section,.days-section{margin:8px 0}.ez-section-title{font-size:12px;font-weight:700;margin:8px 0 6px;color:#374151;text-align:right}.ez-pill-container{display:flex;justify-content:center;gap:8px;margin-bottom:4px}.ez-pill{width:50px;height:50px;border-radius:10px;background:#fff;border:2px solid #e5e7eb;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:800;cursor:pointer;transition:all 0.3s;color:#6b7280}.ez-pill:hover{border-color:#3b82f6;color:#3b82f6;transform:translateY(-2px)}.ez-pill.selected{background:#3b82f6;border-color:#3b82f6;color:#fff;transform:translateY(-2px) scale(1.05)}.ez-buttons-container{display:flex;gap:8px;margin-top:14px}.ez-btn{flex:1;padding:10px 14px;border:none;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;transition:all 0.3s;font-family:Cairo,sans-serif}.ez-submit-btn{background:#10b981;color:#fff}.ez-submit-btn:hover{background:#059669;transform:translateY(-1px)}.ez-cancel-btn{background:#fff;border:2px solid #e5e7eb;color:#6b7280}.ez-cancel-btn:hover{background:#f9fafb;transform:translateY(-1px)}.ez-credit{font-size:9px;color:#6b7280;margin-top:10px;padding-top:8px;border-top:1px solid #f3f4f6;font-weight:600}.ez-advanced{background:#fff;border-radius:10px;padding:10px;margin:10px 0;text-align:right;border:2px solid #e5e7eb;box-shadow:0 2px 6px rgba(0,0,0,0.05)}.ez-checkbox-line{display:flex;align-items:center;margin:6px 0;padding:8px 10px;background:#f8fafc;border-radius:8px;cursor:pointer;transition:all 0.3s;border:2px solid #e5e7eb;position:relative}.ez-checkbox-line:hover{background:#eff6ff;border-color:#3b82f6;transform:translateX(-2px)}.ez-checkbox-line input[type="checkbox"]{position:absolute;opacity:0;width:0;height:0}.ez-checkbox-custom{width:18px;height:18px;border:2px solid #cbd5e1;border-radius:50%;margin:0 8px 0 0;position:relative;transition:all 0.3s;background:#fff;flex-shrink:0}.ez-checkbox-line input[type="checkbox"]:checked+.ez-checkbox-custom{background:linear-gradient(135deg,#3b82f6,#2563eb);border-color:#3b82f6;box-shadow:0 0 0 2px rgba(59,130,246,0.2)}.ez-checkbox-custom::after{content:"âœ“";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);color:#fff;font-size:12px;font-weight:900;transition:all 0.2s}.ez-checkbox-line input[type="checkbox"]:checked+.ez-checkbox-custom::after{transform:translate(-50%,-50%) scale(1)}.ez-checkbox-label{font-size:12px;color:#1e293b;font-weight:600;flex:1}.ez-checkbox-icon{font-size:14px;margin-left:4px;opacity:0.7}.warning-dialog{background:#fff;border-radius:12px;padding:24px;max-width:550px;max-height:75vh;overflow-y:auto;box-shadow:0 16px 50px rgba(0,0,0,0.3);font-family:Cairo,sans-serif}.warning-header{display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:16px;padding-bottom:12px;border-bottom:2px solid #fee2e2}.warning-icon{font-size:32px}.warning-title{font-size:18px;font-weight:800;color:#dc2626}.warning-list{margin:16px 0}.warning-item{background:#f8fafc;border-left:4px solid #3b82f6;padding:12px;margin:8px 0;border-radius:8px}.warning-item.warning-danger{border-left-color:#dc2626;background:#fef2f2}.warning-item.warning-warning{border-left-color:#f59e0b;background:#fffbeb}.warning-item.warning-info{border-left-color:#3b82f6;background:#eff6ff}.warning-text{font-size:12px;color:#1e293b;margin-bottom:8px;font-weight:600}.warning-edit{margin-top:8px}.warning-edit label{display:block;font-size:11px;color:#64748b;margin-bottom:4px;font-weight:600}.warning-edit input{width:100%;padding:6px;border:2px solid #e2e8f0;border-radius:6px;font-size:14px;font-weight:700}.warning-edit input:focus{border-color:#3b82f6;outline:none}.warning-actions{display:flex;gap:8px;margin-top:16px}.warning-btn{flex:1;padding:12px;border:none;border-radius:8px;font-size:13px;font-weight:800;cursor:pointer;font-family:Cairo,sans-serif;transition:all 0.3s}.warning-accept{background:#10b981;color:#fff}.warning-accept:hover{background:#059669;transform:translateY(-1px)}.warning-cancel{background:#f1f5f9;color:#64748b}.warning-cancel:hover{background:#e2e8f0;transform:translateY(-1px)}.unique-count-badge{background:#2196f3;color:#fff;padding:0 12px;border-radius:5px;font-size:12px;font-weight:700;margin-left:10px;display:inline-flex;align-items:center;vertical-align:middle;height:28px}.end-date-alert{background:#fff;border-radius:12px;padding:24px;max-width:450px;box-shadow:0 16px 50px rgba(0,0,0,0.3);font-family:Cairo,sans-serif}.alert-header{font-size:17px;font-weight:800;color:#f59e0b;margin-bottom:16px;text-align:center;display:flex;align-items:center;justify-content:center;gap:8px}.alert-body{font-size:13px;color:#1e293b;margin-bottom:20px;text-align:center;line-height:1.5}.alert-actions{display:flex;gap:8px}.alert-btn{flex:1;padding:12px;border:none;border-radius:8px;font-size:13px;font-weight:800;cursor:pointer;font-family:Cairo,sans-serif;transition:all 0.3s}.alert-fix{background:#10b981;color:#fff}.alert-fix:hover{background:#059669;transform:translateY(-1px)}.alert-cancel{background:#f1f5f9;color:#64748b}.alert-cancel:hover{background:#e2e8f0;transform:translateY(-1px)}.ez-toast{position:fixed;bottom:30px;right:30px;background:#fff;padding:12px 16px;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,0.2);z-index:999999;display:flex;align-items:center;gap:8px;font-family:Cairo,sans-serif;transform:translateX(400px);opacity:0;transition:all 0.3s}.ez-toast.show{transform:translateX(0);opacity:1}.ez-toast-icon{font-size:16px}.ez-toast-msg{font-size:12px;font-weight:600;color:#1e293b}.ez-toast-success{border-left:4px solid #10b981}.ez-toast-error{border-left:4px solid #ef4444}.ez-toast-info{border-left:4px solid #3b82f6}.ez-toast-warning{border-left:4px solid #f59e0b}.ez-loader{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;padding:32px 48px;border-radius:14px;box-shadow:0 10px 35px rgba(0,0,0,0.3);z-index:99998;text-align:center;font-family:Cairo,sans-serif}.ez-loader-spinner{width:40px;height:40px;border:4px solid #e2e8f0;border-top-color:#3b82f6;border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto 12px}@keyframes spin{to{transform:rotate(360deg)}}.ez-loader-text{font-size:13px;font-weight:700;color:#1e293b}table td,table th{border:1px solid #bbb!important}.ez-welcome{text-align:center;padding:20px 0 10px;border-bottom:2px solid #e5e7eb;margin-bottom:20px}.ez-welcome-icon{font-size:48px;margin-bottom:8px;animation:pulse 2s infinite}@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}.ez-welcome-text{font-size:16px;font-weight:800;color:#1e293b;background:linear-gradient(135deg,#3b82f6,#8b5cf6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.ez-divider{height:2px;background:linear-gradient(90deg,transparent,#e5e7eb,transparent);margin:20px 0}.ez-advanced-title{font-size:13px;font-weight:700;color:#64748b;margin-bottom:12px;padding:0 4px;display:flex;align-items:center;gap:6px}.title-icon{font-size:16px}.pill-number{font-size:20px;font-weight:800;color:#1e293b;margin-bottom:2px}.pill-label{font-size:10px;color:#64748b;font-weight:600}.ez-pill.selected .pill-number{color:#fff}.ez-pill.selected .pill-label{color:rgba(255,255,255,0.9)}.btn-icon{font-size:16px;margin-left:4px}';document.head.appendChild(s_style);var d_box=document.createElement('div');d_box.id='ez-dialog-box';d_box.className='ez-dialog';d_box.setAttribute('data-m','1');d_box.setAttribute('data-t','30');d_box.setAttribute('data-extraction-mode','manual');d_box.innerHTML='<div class="ez-header"><div class="ez-title">'+APP_NAME+'</div><div style="display:flex;align-items:center;gap:8px;"><button class="ez-minimize-btn" onclick="window.ezMinimize()">âˆ’</button><div class="ez-version">v'+APP_VERSION+'</div></div></div><div class="ez-content"><div class="ez-welcome"><div class="ez-welcome-icon">âš¡</div><div class="ez-welcome-text">Ù†Ø¸Ø§Ù… Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ÙˆØµÙØ§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</div></div><div class="options-section"><div class="months-section"><div class="ez-section-title"><span class="title-icon">ğŸ“…</span> Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø±</div><div class="ez-pill-container"><div class="ez-pill selected" onclick="window.ezSelect(this,\'m\',1)"><div class="pill-number">1</div><div class="pill-label">Ø´Ù‡Ø±</div></div><div class="ez-pill" onclick="window.ezSelect(this,\'m\',2)"><div class="pill-number">2</div><div class="pill-label">Ø´Ù‡Ø±ÙŠÙ†</div></div><div class="ez-pill" onclick="window.ezSelect(this,\'m\',3)"><div class="pill-number">3</div><div class="pill-label">Ø£Ø´Ù‡Ø±</div></div></div></div><div class="days-section"><div class="ez-section-title"><span class="title-icon">ğŸ“Š</span> Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… ÙÙŠ Ø§Ù„Ø´Ù‡Ø±</div><div class="ez-pill-container"><div class="ez-pill" onclick="window.ezSelect(this,\'t\',28)"><div class="pill-number">28</div><div class="pill-label">ÙŠÙˆÙ…</div></div><div class="ez-pill selected" onclick="window.ezSelect(this,\'t\',30)"><div class="pill-number">30</div><div class="pill-label">ÙŠÙˆÙ…</div></div></div></div></div><div class="ez-divider"></div><div class="ez-advanced-title">âš™ï¸ Ø®ÙŠØ§Ø±Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</div><div class="ez-advanced"><div class="ez-checkbox-line" onclick="var cb=this.querySelector(\'input\');cb.checked=!cb.checked;"><input type="checkbox" id="auto-duration" checked><span class="ez-checkbox-custom"></span><label class="ez-checkbox-label">Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø¯Ø© Ù…Ù† Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label><span class="ez-checkbox-icon">âœ¨</span></div><div class="ez-checkbox-line" onclick="var cb=this.querySelector(\'input\');cb.checked=!cb.checked;"><input type="checkbox" id="show-warnings" checked><span class="ez-checkbox-custom"></span><label class="ez-checkbox-label">Ø¹Ø±Ø¶ Ø§Ù„ØªØ­Ø°ÙŠØ±Ø§Øª</label><span class="ez-checkbox-icon">âš ï¸</span></div><div class="ez-checkbox-line" onclick="var cb=this.querySelector(\'input\');cb.checked=!cb.checked;"><input type="checkbox" id="show-post-dialog" checked><span class="ez-checkbox-custom"></span><label class="ez-checkbox-label">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©</label><span class="ez-checkbox-icon">ğŸ¯</span></div></div><div class="ez-buttons-container"><button class="ez-btn ez-submit-btn" onclick="window.ezSubmit()"><span class="btn-icon">âš¡</span> Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</button><button class="ez-btn ez-cancel-btn" onclick="window.ezCancel()"><span class="btn-icon">âœ–</span> Ø¥Ù„ØºØ§Ø¡</button></div></div><div class="ez-credit">ğŸ’Š Ù…Ø·ÙˆØ± Ø§Ù„ÙƒÙˆØ¯: Ø¹Ù„ÙŠ Ø§Ù„Ø¨Ø§Ø² | v'+APP_VERSION+'</div>';document.body.appendChild(d_box);document.addEventListener('keydown',function(e){if(e.key==='Enter'){var sub=document.querySelector('.ez-submit-btn');if(sub)sub.click();}else if(e.key==='Escape'){var can=document.querySelector('.ez-cancel-btn');if(can)can.click();}});makeDraggable(d_box);})();
})();
